2006-01-16  Emmanuele Bassi  <ebassi@cvs.gnome.org>

	* src/gdict-window.c (gdict_window_error_cb): remove the busy cursor in
	case of error.

2006-01-16  Emmanuele Bassi  <ebassi@cvs.gnome.org>

	* libgdict/gdict-context.c
	* libgdict/gdict-client-context.c
	* libgdict/gdict-defbox.c: use the new and faster g_slice_* calls from
	GLib HEAD in place of g_new.

	* libgdict/gdict-context.c: add the gtk-doc markings to the last
	missing functions.

2006-01-15  Emmanuele Bassi  <ebassi@cvs.gnome.org>

	A data/french.desktop.in
	A data/spanish.desktop.in

	* data/french.desktop.in: add a source definition file for a
	French-based dictionary source.

	* data/spanish.desktop.in: add a source definition file for a
	Spanish-based dictionay source.

	* data/Makefile.am: add the two new dictionary sources.

2006-01-13  Emmanuele Bassi  <ebassi@cvs.gnome.org>

	* src/gdict-applet.c (gdict_applet_init), (gdict_applet_factory):
	move the menu items sensitivity set inside the applet's factory; this
	should close bug #326004 which was triggered if there was a delay
	in the creation of the bonobo ui control.

2006-01-13  Emmanuele Bassi  <ebassi@cvs.gnome.org>

	* src/gdict-applet.c (gdict_applet_set_menu_sensitive),
	(gdict_applet_lookup_start_cb), (gdict_applet_lookup_end_cb),
	(gdict_applet_error_cb), (gdict_applet_init): add a function
	to make the menu items sensitive.

	* src/gdict-applet.c (gdict_applet_style_set): re-compute the
	definition window size request depending on the font size at every
	style change.

	* src/gdict-applet.c (gdict_applet_draw), (gdict_applet_init),
	(gdict_applet_build_window): remove the warnings (they wouldn't be
	displayed anyway) and use error dialogs; mark new strings as
	translatable; add tooltips for the applet widgets.

2006-01-12  Emmanuele Bassi  <ebassi@cvs.gnome.org>

	* libgdict/Makefile.am: fixed the enum generation.

2006-01-11  Emmanuele Bassi  <ebassi@cvs.gnome.org>

	* data/GNOME_DictionaryApplet.xml: change the mnemonic for the "Clear"
	verb.

	* src/gdict-applet.c (gdict_applet_lookup_end_cb),
	(gdict_applet_error_cb), (gdict_applet_init): check before changing the
	menu items' sensivity; this should fix the crasher in bug #326004.

2006-01-11  Emmanuele Bassi  <ebassi@cvs.gnome.org>

	* data/gnome-dictionary.schemas.in: add the new window state keys:
		default-window-height
		default-window-width
		window-is-maximized
	these keys will store the window state across sessions.

	* libgdict/Makefile.am: fix a bug that prevented the right inclusion
	of the headers inside the auto-generated gdict-enum-types.h header
	file.

	* src/gdict-applet.c (gdict_applet_build_window): create the window
	showing the defbox using width and height calculated from the font
	size.

	* src/gdict-applet.c (gdict_applet_icon_toggled_cb),
	(gdict_applet_button_press_event_cb),
	(gdict_applet_icon_button_press_event_cb), (gdict_applet_draw),
	(gdict_applet_lookup_start_cb), (gdict_applet_size_allocate): use a
	ToggleButton instead of a plain Image for the dictionary icon; this
	should make the window toggling a bit more discoverable.  Also, moved
	back the icon before the entry: the window should use it as the
	"attach" widget, as it resizes its height with the panel, while the
	entry does not.

	* src/gdict-pref-dialog.h: add the new GConf keys

	* src/gdict-window.c (gdict_window_finalize: remove the GConf
	notification listener before destroying the window.

	* src/gdict-window.c (gdict_window_cmd_file_new),
	(gdict_window_cmd_file_close_window), (gdict_window_delete_event_cb),
	(gdict_window_state_event_cb), (gdict_window_gconf_notify_cb),
	(gdict_window_size_allocate), (gdict_window_style_set),
	(gdict_window_constructor), (gdict_window_class_init),
	(gdict_window_init): make the window "recall" its size and state
	through sessions using the newly added GConf keys; fallback to the
	font-based size allocation on user request or if no value was
	found (based on the similar code used by Dennis Cranston in
	gsearchtool, closes bug #325887).

	* src/gdict-window.h: add new window state variables.

2005-01-02  Emmanuele Bassi  <ebassi@cvs.gnome.org>

	* src/gdict-app.h:
	* src/gdict-app.c: enable look up via command-line (closes bug
	#325014).

2005-01-02  Emmanuele Bassi  <ebassi@cvs.gnome.org> 

	* src/gdict-app.c: (gdict_app_init): Set execute bit (0700).
	* src/gdict-applet.c: (gdict_applet_init):  Set execute bit (0700).
	* src/gdict-pref-dialog.c: (source_remove_clicked_cb): UI fix
	for remove source confirmation dialog (patch by Dennis Cranston, fixes
	bug #325455).

2005-12-31  Emmanuele Bassi  <ebassi@cvs.gnome.org>

	* src/gdict-window.c (gdict_window_help_contents_cmd): remove the help
	document id.

2005-12-31  Emmanuele Bassi  <ebassi@cvs.gnome.org>

	* data/GNOME_DictionaryApplet.server.in.in: update Bugzilla product to
	"gdict-applet", to disambiguate the applet from the main application;
	update the icon name to the new icon.

	* src/gdict-applet.c: fix the applet and make it work again.

	* src/gdict-pref-dialog.c (response_cb),
	(gdict_pref_dialog_init): intercept the HELP response code and show
	the help without closing the dialog.

2005-12-31  Emmanuele Bassi  <ebassi@cvs.gnome.org>

	* data/gnome-dictionary-preferences.glade:  HIG fixes for
	the add source dialog.  Do not use bold labels.  Use left
	alignment for labels.  Fix the 'H' key mnemonic conflict.  
	Use sentence capitalization for the expander label and indent 
	its contents (patch by Dennis Cranston, closes bug #325340).

2005-12-30  Emmanuele Bassi  <ebassi@cvs.gnome.org>

	* data/gnome-dictionary.1: final touches to the man page.

2005-12-30  Emmanuele Bassi  <ebassi@cvs.gnome.org>

	* src/gdict-pref-dialog.c (font_button_font_set_cb),
	(gdict_pref_dialog_gconf_notify_cb): brown paper bag fix for
	propagating the print font through GConf (while avoiding loops).

2005-12-30  Emmanuele Bassi  <ebassi@cvs.gnome.org>

	* src/gdict-pref-dialog.c (font_button_font_set_cb): tighter checks on
	the fonts to prevent a segmentation fault.

2005-12-30  Emmanuele Bassi  <ebassi@cvs.gnome.org>

	* src/gdict-source-dialog.c (gdict_source_dialog_constructor): switch
	the cancel and add buttons.

2005-12-30  Emmanuele Bassi  <ebassi@cvs.gnome.org>

	* libgdict/gdict-client-context.c
	(gdict_client_context_lookup_server): make the hostname lookup cache
	expire after five minutes; this should tentatively solve bug #169915.

2005-12-30  Emmanuele Bassi  <ebassi@cvs.gnome.org>

	Re-sync with my development trunk: add the new source dialog code; fix
	a slew of typos and a serious crasher; more UI fixes.

	A data/gnome-dictionary.png
	A src/gdict-source-dialog.h
	A src/gdict-source-dialog.c

	* libgdict/gdict-entry.c,
	src/gdict-pref-dialog.c,
	src/gdict-about.c,
	src/gdict-app.c,
	src/gdict-applet.c: fix some typos.

	* src/gdict-window.c (gdict_window_class_init): we don't need
	translatable properties, here.

	* src/Makefile.am: add gdict-source-dialog.[ch] to the build.

	* src/gdict-pref-dialog.c,
	src/gdict-source-dialog.h,
	src/gdict-source-dialog.c: move out the
	source dialog into its own file; make it flexible enough to allow
	further expansion when sources view and editing will be added.

	* src/gdict-about.c: add support for the new icon.

	* libgdict/gdict-context.c: add documentation

	* data/gnome-dictionary.1: update the man page.

	* data/gnome-dictionary-preferences.glade: update the UI for the
	source dialog.

	* src/gdict-about.c,
	src/gdict-app.c,
	src/gdict-applet.c,
	src/gdict-window.c,
	src/gdict-window.h: add support for the new icon.
	
	* data/gnome-dictionary.desktop.in: add the new icon
	
	* data/gnome-dictionary.png: new icon for the dictionary.

	* data/Makefile.am: add the appicon target

	* libgdict/gdict-defbox.c (create_progress_dialog): UI fixes (patch
	from Dennis Cranston, closes bug #324860).
	
	* src/gdict-window.c (gdict_window_lookup_start_cb), 
	(gdict_window_lookup_end_cb), (entry_activate_cb), 
	(gdict_window_drag_data_received_cb):  Fix a couple regressions:
	1) change window title format to "word - App Name" per HIG.
	2) display a busy cursor while looking up words (patch from Dennis
	Cranston, closes bug #324860).

	* src/gdict-window.c (gdict_window_error_cb), (gdict_window_set_word),
	(entry_activate_cb), (gdict_window_drag_data_received_cb): fix a
	double-free bug triggered by a failed look up (patch from Paolo
	Borelli, closes bug #325238).

2005-12-25  Emmanuele Bassi  <ebassi@cvs.gnome.org>

	The "Maybe this Christmas" release.  This release marks the end of the
	big UI and feature changes: from now on, it's fixes time until the next
	development cycle.  Merry Christmas everyone.

	* src/gdict-print.c: fix compiler warnings about parameter signedness.

	* data/gnome-dictionary-preferences.glade: update the source add dialog
	with a new UI.

	* docs/reference/gdict/gdict-decl-list.txt: add
	gdict_defbox_set_database() and gdict_defbox_get_database() to the
	declarations list.

	* src/gdict-about.c: use "Look up".

	* src/gdict-app.c (gdict_app_init): create the data directory inside
	$HOME/.gnome2 when creating the application singleton.

	* src/gdict-applet.c (gdict_applet_init): ditto.

	* src/gdict-pref-dialog.c: add the source add dialog, and enable the
	source remove code: now the user can create new dictionary sources
	without having to actually drop a file inside the data directory.  The
	code is still a bit flaky, but this closes all the UI/feature work for
	the release.

	* src/gdict-window.c (gdict_window_cmd_help_contents): fix error
	message.

2005-12-21  Emmanuele Bassi  <ebassi@cvs.gnome.org>

	* src/gdict-window.c: fix a bunch of compiler warnings (patch by
	Kjartan Maraas, closes	bug #324552).

	* src/gtkalignedwindow.c (gtk_aligned_window_finalize),
	(gdict_aligned_window_get_widget): ditto.

	* src/main.c: include libintl.h.
	
	* src/gdict-applet.c (gdict_applet_init),
	(gdict_applet_gconf_notify_cb): hook up the notification callback and
	monitor the database and strategy keys.

	* src/gdict-app.c (gdict_window_destroy_cb), (gdict_init),
	(gdict_main): fix compiler warnings (patch by Kjartan Maraas, closes
	bug #324552).

	* src/gdict-about.c: use "Look up" instead of "Lookup".

	* README: remove the warnings.

2005-12-19  Emmanuele Bassi  <ebassi@cvs.gnome.org>

	* libgdict/Makefile.am: fix stamp_files build

2005-12-19  Emmanuele Bassi  <ebassi@cvs.gnome.org>

	* libgdict/gdict-defbox.c (create_find_pane): another shot at getting
	the find pane layout right (closes bug #324342).

2005-12-19  Emmanuele Bassi  <ebassi@cvs.gnome.org>

	* data/GNOME_DictionaryApplet.server.in.in: add the old GDict applet
	OAFIID to the .server file, for backward compatibility.

	* data/GNOME_DictionaryApplet.xml: add the "Save" verb.

	* data/gnome-dictionary-preferences.glade: remove the _ char from the
	notebook tab labels.

	* libgdict/gdict-defbox.c (gdict_defbox_find_forward),
	(find_next_clicked_cb), (find_entry_changed_cb): add support for
	find-as-you-type search.

	* libgdict/gdict-defbox.c (gdict_defbox_default_constructor): remove
	word wrapping from the TextView widget.

	* libgdict/gdict-defbox.c (lookup_end_cb): explicitely move the cursor
	to the beginning of the definition text.

	* src/gdict-applet.c: implement the popup menu callbacks; support the
	"database" and "strategy" options; add a "Save" button to the
	definition window; add ATK names and descriptions to the applet
	widgets; add a gdict_applet_queue_draw() for drawing the applet inside
	an idle loop; remove debug code; handle the definition window and menu
	items visibility depending on what the query results are; port
	preferences setting functions from GdictWindow.

	* src/gdict-window.c (gdict_window_style_set),
	(gdict_window_constructor), (gdict_window_init): make the default size
	of the window depend on the display font size, in order to show the
	pre-formatted text coming from a dictionary server.

2005-12-19  Emmanuele Bassi  <ebassi@cvs.gnome.org>

	* data/gnome-dictionary-preferences.glade: use "Source" and "Print" as
	notebook tab label strings, and mark them translatable.

2005-12-19  Emmanuele Bassi  <ebassi@cvs.gnome.org>

	* docs/reference/gdict/gdict-sections.txt: add new functions.

2005-12-19  Emmanuele Bassi  <ebassi@cvs.gnome.org>

	Another set of UI patches.

	* libgdict/gdict-defbox.c (find_prev_clicked): UI fixes.

	* libgdict/gdict-defbox.c (create_find_pane): fix find pane layout.

	* data/gnome-dictionary-preferences.glade:
	* src/gdict-pref-dialog.c (source_add_clicked_cb),
	(gdict_pref_dialog_init):  HIG related fixes such as
	mnemonics, widget spacing, etc. (Patch by Dennis Cranston).

2005-12-18  Emmanuele Bassi  <ebassi@cvs.gnome.org>

	* src/gdict-window.c: use the "database" property, and hook it up to
	GConf.

	* libgdict/gdict-defbox.h, libgdict/gdict-defbox.c: add the "database"
	property; add the gdict_defbox_set_database() and
	gdict_defbox_get_database() accessors for the "database" property.

2005-12-17  Emmanuele Bassi  <ebassi@cvs.gnome.org>

	A bunch UI fixes from Dennis Cranston, and a bunch of fixes triggered
	by a down of dict.org.

	* libgdict/gdict-defbox.c, src/gdict-window.c: fix lifetime of the
	GdictContext and related signal handlers.

	* libgdict/gdict-client-context.c (gdict_client_context_finalize),
	(clear_command_queue): fix a double free bug issued when finalizing a
	ClientContext with a non-empty queue (patch by Paolo Borelli).

	* libgdict/gdict-client-context.c: emit "error" when unable to connect
	to the dictionary server.

	* libgdict/gdict-defbox.c:  UI fixes for the find widgets (patch by
	Dennis Cranston).

	* src/gdict-window.c:  UI fixes.  Fix widget spacing.  Change 
	"find" back to "look up" to avoid confusion caused by its 
	double use (patch by Dennis Cranston).

	* libgdict/gdict-source.c: fix the "context" propery;

	* src/gdict-window.c: add "source-name" and "word" constructor
	properties, so that a window might be created with a pre-defined
	source and word to look up.

	* libgdict/gdict-app.c (gdict_create_window),
	(gdict_window_created_cb), (gdict_window_destroy_cb): fix multiple
	registration of callbacks and remove the loop on the windows list for
	good (based on a patch by Paolo Borelli).

	* src/gdict-app.c: begin command line arguments support, and attach
	a GOptionContext to gnome_program_init().

2005-12-15  Emmanuele Bassi  <ebassi@cvs.gnome.org>

	* src/gdict-applet.h, src/gdict-applet.c: create the dictionary applet.

	* src/gdict-app.c: do not leak the GOptionContext.

	* libgdict/gdict-client-context.c (gdict_client_context_parse_line):
	add more debug messages; do not tokenize the line, but walk it.

	* libgdict/gdict-client-context.c (get_status_code): make the
	status code check more robust (too many false positives).

	* libgdict/gdict-defbox.c: make the error checking a bit more robust.

	* data/gnome-dictionary.schemas.in: mark the following keys as
	obsolete and deprecated:

		- server
		- port
		- smart
	
	and add the following keys:

		- source-name
		- print-font
	
	* data/default.desktop.in: don't mark the Name key as translatable.

	* libgdict/gdict-source-loader.h, libgdict/gdict-source-loader.c: add
	gdict_source_loader_remove_source() and gdict_source_loader_update();
	the former removes a dictionary source file and the latter forces an
	update of the sources list.

	* src/gdict-print.h, src/gdict-print.c: remove the print-related
	stuff from gdict-window in order to use them inside the applet.

	* src/gdict-pref-dialog.c, src/gdict-pref-dialog.h: create the
	GdictPrefDialog widget; this dialog will be used to handle the
	preferences for both the application and the applet.  You can
	change the active dictionary source and the print font; missing
	bits: add a new source (create a new GdictSource and dump it
	into a tmpfile inside .gnome2/gnome-dictionary) and remove a
	source (the code is already in place, but compiled out until the
	add source stuff is in).

	* data/gnome-dictionary-preferences.glade: create the UI for
	the preferences dialog.

	* libgdict/gdict-source.h, libgdict/gdict-source.c: add the
	"database" and "strategy" properties to GdictSource, and relative
	accessor functions; these properties set the default database and
	strategy used for a dictionary source; implement the API for
	creating a dictionary source: the output is in form of a string,
	it'll be up to the caller to create an actual file; make the Name
	key not localizable: it's the unique identifier for the source, and
	the user should only see the content of the Description key.

	* src/gdict-window.c: add a footer line when printing, and fix the
	page counting; add the help link; add GConf support.

2005-12-10  Emmanuele Bassi  <ebassi@cvs.gnome.org>

	* libgdict/gdict-client-context.c (gdict_client_context_parse_line):
	avoid emission of spurious "lookup-end" signals; rework the server
	error response parsing.

	* libgdict/gdict-defbox.c: grab focus on the find entry when showing
	the find pane; add a progress dialog for showing the state of the
	definition lookup.

	* data/gnome-dictionary-ui.xml, src/gdict-window.h, src/gdict-window.c:
	add support for a <control>L accelerator, used to highlight the "Find"
	entry; add a mnemonic for the "Find" entry; add a status bar; link the
	GdictContext signals; various bug fixes.

2005-12-09  Emmanuele Bassi  <ebassi@cvs.gnome.org>

	* libgdict/gdict-source.h: add gdict_source_peek_context() and
	gdict_source_steal_context().

	* libgdict/gdict-source.c (gdict_source_get_context): create a new
	context each time; the old behaviour has been shifted to the
	gdict_source_peek_context() function.

	* src/gdict-window.h, src/gdict-window.c: add the "created" signal,
	which is fired each time a new GdictWindow has been created by another
	GdictWindow.

	* src/gdict-window.c (gdict_window_cmd_file_new): create a new
	GdictWindow instance, and fire the "created" signal.

	* src/gdict-app.c: use the GdictWindow::created signal to add the newly
	created window to the windows list, like we use the GtkWidget::destroy
	signal to remove GdictWindow instances from the list.

2005-12-09  Emmanuele Bassi  <ebassi@cvs.gnome.org>

	* help/C/gnome-dictionary.xml: fix manual stub, so that make check
	passes.

2005-12-09  Emmanuele Bassi  <ebassi@cvs.gnome.org>

	* src/gdict-window.h, src/gdict-window.c: move GdictWindow into its own
	file; add printing support (still experimental).

	* src/gdict-app.h, src/gdict-app.c: remove GdictWindow

	* .cvsignore, data/.cvsignore, src/.cvsignore: add cvs ignore files.

	* libgdict/gdict-defbox.c: clear content on error.

2005-12-07  Emmanuele Bassi  <ebassi@cvs.gnome.org>

	* README: add a visible warning on the experimental nature of this
	branch; add some build tips.

	* TODO: update list.

2005-12-07  Emmanuele Bassi  <ebassi@cvs.gnome.org>

	* data/Makefile.am: add gnome-dictionary-ui.xml, the GtkUIManager
	definitions of the menu bar and accelerators.

	* docs/source-configuration.txt: add Database and Strategy keys.

	* libgdict/gdict-client-context.c: add "total" property support for
	GdictDefinition.

	* libgdict/gdict-context-private.h,
	libgdict/gdict-context.c,
	libgdict/gdict-context.h: add "total" property, and change
	GdictDefintion ctor (we don't need a word).

	* libgdict/gdict-defbox.h, libgdict/gdict-defbox.h: add
	gdict_defbox_new_with_context() ctor; add new API to wrap around
	GtkTextView/GtkTextBuffer.

	* libgdict/gdict-source.c, libgdict/gdict-source-loader.c: fix bugs
	inside the GdictSource and GdictSourceLoader.

	* libgdict/gdict-source.h: add gdict_source_load_from_data().

	* libgdict/gdict-utils.c: remove title from the error dialog, as per
	HIG; fix a stupid bug in get_toplevel_window().

	* src/Makefile.am: remove the applet data, since we don't have any code
	for it, yet.

	* src/gdict-app.h, src/gdict-app.c: begin Dictionary UI; GdictWindow is
	a GtkWindow subclass; GdictApp is a singleton object, holding all the
	windows.

	* src/gdict-about.h, src/gdict-about.c: add a simple wrapper around
	GtkAboutDialog.

	* src/main.c: main application launcher.

2005-11-29  Emmanuele Bassi  <ebassi@cvs.gnome.org>

	* libgdict/gdict-defbox.c: fix forward/backward searching.

2005-11-29  Emmanuele Bassi  <ebassi@cvs.gnome.org>

	* libgdict/Makefile.am: add LIBGLADE_* macros to the application and
	applet CFLAGS

	* libgdict/gdict-utils.[ch]: add gdict_show_error_dialog() and the
	gdict_show_gerror_dialog() functions for showing error message dialogs.

	* libgdict/gdict-defbox.[ch]: begin re-implementation of the
	GdictDefbox widget.  This widget is used to show the definitions
	retrieved by a GdictContext implementation.

	* libgdict/test-defbox.c: test case for GdictDefbox.

2005-11-24  Emmanuele Bassi  <ebassi@cvs.gnome.org>

	* data/default-dictionary.desktop.in: remove translatable mark to
	the Name key: this is the default, and should always be accessed using
	the "Default" name.

	* libgdict/Makefile.am: fix CLEANFILES and DISTCLEANFILES.

	* libgdict/gdict-source.c, libgdict/gdict-source-loader.c: fix stupid
	bugs.

	* libgdict/test-source.c: add test suite for GdictSource and
	GdictSourceLoader.

	* libgdict/Makefile.am: add test-source.c

	* libgdict/.cvsignore: add test-source.

	* libgdict/gdict-preferences.[ch]: remove these files.

2005-11-22  Emmanuele Bassi  <ebassi@cvs.gnome.org>

	* libgdict/.cvsignore: add .cvsignore

	* libgdict/test-defbox.c: add (empty) test suite for GdictDefbox.

	* libgdict/test-entry.c: add test suite for GdictEntry.

	* libgdict/gdict-source-loader.[hc]: add GdictSourceLoader, an object
	for loading all the dictionary source files.

	* libgdict/gdict-source.[hc]: add GdictSource, an object for loading
	the right GdictContext based on .desktop files.

	* libgdict/Makefile.am: add new files to the build.

	* data/default-dictionary.desktop.in: default dictionary source for
	dict.org.

	* data/Makefile.am: add default-dictionary.desktop.in and i18n rule for
	translation support.

	* libgdict/gdict-version.h.in: add versioning to libgdict
	
	* libgdict/gdict.h: include gdict-version.h

	* TODO: update list

2005-11-21  Emmanuele Bassi  <ebassi@cvs.gnome.org>

	* libgdict/gdict-client-context.c
	(gdict_client_context_real_connected),
	(gdict_client_context_force_disconnect),
	(gdict_client_context_lookup_server): fix comments

	* libgdict/gdict-client-context.c
	(gdict_client_context_parse_line): fix the "lookup-end" signal
	emission.

	* libgdict/test-client.c: add callbacks for the lookup-start and
	lookup-end signals

2005-11-21  Emmanuele Bassi  <ebassi@cvs.gnome.org>

	Initial import of gnome-dictionary.

	* libgdict/*: the GdictContext interface and GdictClientContext class
	are basically done; GdictClientContext implements a RFC2229-compliant
	client for a dictionary server using the dictionary protocol.
