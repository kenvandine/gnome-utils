1998-04-21  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* gncal-day-panel.c (calendar_day_selected): Fix, years for mktime
	should substract 1900 and gtk_calendar stores years relative to
	year 0. 

	* gncal-week-view.c (gncal_week_view_new): Make the week view
	descend from VBox so that we can add a label to it.
	(gncal_week_view_set): Display the ending day of the week
	correctly.

	Added a label that displays the week range. 

1998-04-21  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* gnome-cal.c: Made it use GncalDayPanel.

	* gncal-day-panel.c: New widget for the day view in the main
	calendar toplevel.  It basically takes care of everything
	gnome-cal did by hand with respect to the day view.

	* Makefile.am (gnomecal_SOURCES): Added gncal-day-panel.[ch] to
	the rules.

	* main.c: Added a separator between the About menu item and the
	help topics.

1998-04-20  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* eventedit.c (ee_ok): Mark the event as non-new after accepting changes.
	
1998-04-20  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* gncal-full-day.c (gncal_full_day_get_day_start_yoffset): New
	public function that returns the y offset for the row
	corresponding to the "day begin" time.

	* gncal-full-day.c (gncal_full_day_key_press): Now any printable
	keystroke (not just Return) will activate the selected range.

	* gncal-full-day.c (paint_back): Made it use the new paint_row
	function instead of painting everything directly.  We calculate
	areas in a smarter way so there is even less flicker than before,
	especially when selecting regions.

	* eventedit.c: Sensitize recurrence widgets properly.

	* calobj.c (duration_callback): Pass the correct pointer type to
	is_date_in_list().

1998-04-20  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* calobj.c (duration_callback): Take exception dates into
	account. 

	* gncal-full-day.c (new_appointment): Setup the event editor dates
	to those of the currently displayed day. 
	(gncal_full_day_selection_range): Use sensible values in the case
	no range is selected.
	(new_appointment): Events now use the current day for event creation.

	* view-utils.c: Pretty up the time display.

	* calobj.c (ical_object_compute_end): Initialize
	ico->recur->enddate, otherwise we loop forever during final date computation.

	* eventedit.c: Now recurrence is toggled by a radio button in the
	recurrence page, as the checkbox is confusing. 

	* calobj.c (is_date_in_list): Add support for the exclussion
	dates. 

1998-04-18  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* gncal-year-view.c (double_click): Fix this routine as well.

	* gncal-week-view.c (jump_to_day): Bind the gtkcalendar signals to
	the week. 

	* gncal-year-view.c (gncal_year_view_set_year): Put things in the
	proper range.  Now the year view actually matches this year. 

	* gnome-cal.html: Added small documentation.

	* main.c: Add more icons to the menus;  Rename some menubar
	entries;  Add `new' icon to the toolbar.
	(dump_events): Added argument handling and dumping of events from
	the command line.  Extremely cool.

	* getdate.y: Taken from the CVS source code.  Used for date
	parsing in the command line.

	Internationalized getdate.y.  Wee!  It even works with spanish. 
	
	* calobj.c (ical_object_to_vobject): Add Quoted printable property
	to items containing new lines. 
	(duration): Use unsigned integers, to work around buggy calendar
	files generated by korganizer.

	* main.c (save_calendar_cmd): Do not ask for file name if we are
	saving.
	(save_as_calendar_cmd): New command.
	

1998-04-17  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* alarm.c (alarm_kill, alarm_init, alarm_add): Implement the alarm
	management framework.

1998-04-17  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* calobj.c (ical_new): Added mandatory status property.
	(ical_object_to_vobject): Only store "related" list if it exists.
	(store_list): Add terminating null char and free the correct data.

	* main.c (save_calendar_cmd): Implemented calendar saving.
	(open_calendar_cmd): Implemented calendar loading.
	(new_calendar_cmd): Implemented calendar creation.
	(new_calendar): Don't load our test calendar by default.

	* gncal-full-day.c (delete_appointment): Delete appointment implemented.

	* eventedit.c (ee_store_recur_values_to_ical): Free/create
	ical's recurrence appropriately.
	(ee_rp_init_rule): Initialize all missing parameters from ical.
	(ee_rp_init_ending_date): Initialize missing fields from ical.

1998-04-17  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* gnome-cal.c (gnome_calendar_remove_object): Add support for
	removing objects.

1998-04-17  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* eventedit.c (ee_init_recurrence_page): New function that creates
	the recurrence page in the toplevel notebook.
	(ee_store_recur_values_to_ical): Now we can also store the recurrences.

1998-04-17  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* calobj.c (ical_object_generate_events): Implement
	RECUR_MONTHLY_BY_POS implemented.
	(ical_object_create_from_vobject): Fix the alarm
	initialization code.
	(save_alarm): Save alarms.
	(ical_object_generate_events): Fixed the recurrent code to take
	into account the recur->endate field (if at all specified).

	(ical_object_to_vobject): Implement recurrence rule saving.

1998-04-16  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* eventedit.c (ee_store_alarm): Use menu_shell->children, not
	menu->children.  Why does GtkMenu have a children field in the
	object structure?
	(check_dates): New function that insures that start_date < end_date.
	(check_times): In addition to checking whether the event spans the
	whole day, now it insures that start_time < end_time.

	* gncal-full-day.c (child_set_size): Now children get bigger
	temporarily while they are focused.  This allows the handles not
	to "overlap" the rows used by the child and thus allow editing of
	very thin events.
	(recompute_motion): Fix for new child coordinates.
	(gncal_full_day_expose): Make it use find_child_by_window()
	instead of looking for it by hand.

	* bell.xpm recur.xpm: XPM files for events with alarm and
	recurrence, respectively.

1998-04-15  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* gncal-full-day.c (button_1): Preserve the up/down cursor while dragging.

	* gncal-full-day.c (child_draw): Now children have a vertical
	handle as well.  This can be used to move the child anytime, not
	only when it is focused.
	(recompute_motion): Modified for new drag behavior.

	* eventedit.c (ee_init_general_page): The general_owner may be
	null.  Do the proper thing when creating the label.
	(ee_ok): Update the gnome calendar appropriately.

	* timeutil.h:
	* gncal-year-view.h: Add some missing prototypes.

	* gncal-full-day.c (child_popup_menu): Set the sensitivity of menu
	items according to whether the ical object is being edited or not.

	* eventedit.c (event_editor_new): Set the "being edited" flag on
	the ical object (stored as the ical object's user data).
	(event_editor_destroy): Release the flag.

	* calobj.h: The iCalObject structure now has a generic user_data pointer.
	* calobj.c (ical_object_set_user_data ical_object_get_user_data):
	Functions to set this data.

	* gncal-full-day.c (child_button_press): Do child popup menu correctly.

	* main.c (about_calendar_cmd): Fixed my address and added Arturo
	to the authors in the about box.

	* gncal-full-day.c (find_child_by_window): Compare child's widget
	windows by user_data (which will be the parent widget, that is,
	the text widget).  We cannot assume that child->widget->window
	will be *the* window we are interested on because there may be
	child widgets with multiple windows.

1998-04-15  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* calobj.c (ical_foreach): Define iterator routine.

1998-04-15  Arturo Espinosa Aldama  <arturo@nuclecu.unam.mx>

	* gncal-year-view.[hc]: Now using time_t for new and set.
	  Random fixes, as well.

1998-04-15  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* gncal-full-day.c (button_3): New popup menus activated with
	mouse button 3.
	(create_appointment): Create a new appointment from the popup
	menus.  See the FIXME.

1998-04-15  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* gncal-full-day.c (layout_kill_rows): Routine to destory rows
	array properly.

	* gncal-year-view.c (gncal_year_view_new): Add missing year in
	call to strftime.

	* calobj.c (ical_object_create_from_vobject): Fixed memory leaks
	from the return values of versit's fakeCString.

1998-04-14  Arturo Espinosa Aldama  <arturo@nuclecu.unam.mx>

	* gncal-year-view.[hc]: New widget for the year view.
	* Makefile.am: added required compilation of the new files.

1998-04-14  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* eventedit.c (event_editor_setup_time_frame): Fixed some table
	expansions to make the dialog look nicer when resized.

	* calobj.c (ignore_space): Fixed compiler warning about unused
	computed value.
	(ocurrencelist): Replace str by p confusion.  Removed unused
	variables value and q.
	(daynumber): Fixed a couple of warnings about unused values.
	(load_recurrence): Removed unused variable c.  Added a default
	clause to the switch(type).

	* eventedit.c (ee_rp_init_frequency): Removed unused variable content.
	Fixed a compiler warning by adding a missing cast.

	* calobj.c (ical_object_create_from_vobject): Make the
	load_recurrence() part work correctly.  Eliminated use of
	syntax_error variable.

1998-04-13  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* gncal-full-day.c (child_key_press): Unfocus the child and focus
	the parent fullday widget when the user presses Esc.

	* gncal-week-view.c (gncal_week_view_update): Now takes object and
	flags parameters.
	* gncal-day-view.c (gncal_day_view_update): Likewise.
	* gncal-full-day.c (gncal_full_day_update): Likewise.
	(child_focus_in): New function.  In conjunction with
	child_focus_out(), these only display the handles in the child
	when it is focused.  The result is that the user can see more of
	the child's text when nothing is focused, and we can also display
	fatter and nicer drag handles.

	* gnome-cal.c (gnome_calendar_object_changed): Now takes an
	additional flags parameter 
	(gnome_calendar_update_all): Made function static.  Now takes
	changed object and flags parameters as well.
	(gnome_calendar_object_changed): Now takes additional flags
	parameter to indicate what changed in the specified object.

	* calobj.h (CalObjectChange): New enum with flags to describe what
	has been changed in an object.

	* gncal-full-day.h: 
	* gncal-full-day.c (gncal_full_day_focus_child): New function to
	let the outside world decide which child to focus.
	(gncal_full_day_focus_child): Bleah.  We have to synthesize a
	click because GtkText will not set the cursor when you focus it.

	* gnome-cal.c (day_view_range_activated): Focus the new child in
	the full day widget.

	* eventedit.c (event_editor_setup_time_frame): Re-aligned some
	widgets to make it look prettier.
	(ee_alarm_widgets): Likewise.
	(ee_init_general_page): Likewise.
	(ee_classification_widgets): Likewise.
	(event_editor_init_widgets): Likewise.

	* gnome-cal.c (day_view_range_activated): Create new object and
	add it to the calendar.  You can now select a range in the
	full-day view, hit Return, and a new event will be added at the
	selected range.  I still have to figure out how to focus this new child.

	* gncal-full-day.c (paint_back): Rewrote function to avoid
	painting an area more than once -- eliminate flicker.
	(paint_back_rows): New function that calls paint_back() only for
	the area of the specified rows.
	(gncal_full_day_button_press): 
	(gncal_full_day_button_release): 
	(gncal_full_day_motion): Made these functions use
	paint_back_rows() instead of paint_back(), to eliminate flicker.  Wheee!

1998-04-12  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* gnome-cal.c (setup_day_view): We now connect to the
	range_activated signal of the fullday widget instead of catching
	key presses ourselves.
	(day_view_range_activated): New function that creates a new
	iCalObject and inserts it into the calendar, not finished yet.

1998-04-11  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* gncal-full-day.c (get_time_from_rows): New function, calculates
	a pair of time_t values from the specified start and number of rows.

	* gncal-full-day.h (GncalFullDayClass): New signal
	"range_activated".  It is emitted when a range is selected and the
	user hits Return.
	(gncal_full_day_selection_range): New function, returns the
	selected range.

	* gncal-full-day.c (struct drag_info): Moved selection information
	to their own fields instead of sharing the child's drag fields.
	This allows us to keep the selection when a child is moved.
	(recompute_motion): Made the case when (row < di->sel_click_row)
	work correctly.

1998-04-11  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* gnome-cal.c (gnome_calendar_goto): Add support for navigating
	on the day view.

	* timeutil.c (time_start_of_day, time_end_of_day, time_day_hour):
	New time manipulation functions. 

	* eventedit.c (ee_rp_init_frequency): Add the different frequency
	editors to a notebook.  Make the notebook startup on the entry
	selected recurrence type;

1998-04-11  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* gncal-full-day.c (recompute_motion): Now we support selecting a
	range in the main window (by clicking+dragging).  It flickers
	horribly and is not perfect, but it is a start.

1998-04-09  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* gncal-full-day.c: #include <string.h>

	* gncal-full-day.c (child_map): Show instead of just map the child
	widget (otherwise the text widget gets confused and will not focus).

	* calobj.c (ical_object_to_vobject): Quote chars as 'x', not "x".

	* calobj.h: Added prototype for ical_object_to_vobject().

	* gnome-cal.c (gnome_calendar_object_changed): New function.  This
	should be called when a calendar object is changed.

	* gncal-full-day.c (update_from_drag_info): Call
	gnome_calendar_object_changed() instead of updating manually.

	* calendar.c (calendar_add_object):
	(calendar_remove_object): Set the modified flag to true.

	* gncal-full-day.c (gncal_full_day_draw): Finished implementing
	this function.

1998-04-08  Raja R Harinath  <harinath@cs.umn.edu>

	* gncal.c (update_calendar): Say `#if 0', not `#ifdef 0'.

1998-04-07  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* eventedit.c: Removed unused global variable parent_class.

	* eventedit.h: Renamed gtk_window field to window.
	Made the parent_class field in the EventEditorClass structure be a
	GtkWindowClass, not a gnome property box class.
	Added prototype for event_editor_get_type().

1998-04-06  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* gncal-week-view.c (gncal_week_view_new): Use the new
	gtk_table_set_homogeneous() instead of setting the variable directly.

1998-04-03  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* eventedit.c (ee_create_ae): Make it return void.
	(ee_alarm_widgets): Remove some unused variables.
	(ee_store_alarm): Make it return void.
	#include <string.h>

	* eventedit.h: #include "gnome-cal.h"

	* calobj.c (list_free): Don't use g_free in the g_list_foreach.

	* calendar.h: Add prototype for calendar_load().

	* timeutil.h: Add prototypes for time_add_*().

	* calendar.c:
	* calobj.c:
	* eventedit.c:
	* gnome-cal.c: #include "timeutil.h"

	* gncal-day-view.c (gncal_day_view_size_request): Make the minimum
	width equal or larger to the title width.

	* main.c: #include "eventedit.h"
	(main): Add a return statement.
	(new_calendar): Show stuff *after* the calendar has been loaded.

	* gnome-cal.c (gnome_calendar_load): Update the day view.
	(setup_widgets): Hackish setup of a day view widget - will fix later.
	(gnome_calendar_init): Initialize all fields.

	* gnome-cal.h: Added day_view field.  Maybe this should be changed
	when the a complete day view panel is complete.

	* gncal-day-view.c (gncal_day_view_update): Draw after update, not
	before.

1998-04-06  Carsten Schaar  <nhadcasc@fs-maphy.uni-hannover.de>

	* versit/.cvsignore: New file.

Fri Apr  3 22:31:54 1998  Tom Tromey  <tromey@cygnus.com>

	* calendar.c: Include <config.h>.

1998-04-03  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* timeutil.c (time_add_year, time_add_year, time_add_week):
	Routines for time manipulation.

	* calobj.c (ical_object_destroy): Full destruction of the object.

	* eventedit.c: Finished the main event editor form;  It still
	lacks the details and the recurrence bits.  It now adds events
	and cancels. 

1998-04-03  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* view-utils.c (view_utils_draw_events): The "better" format
	string for strftime() wasn't better, after all :-(

1998-04-02  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* gncal-full-day.c: New full-day widget.  It is still a work in
	progress.  It will be similar to M$ Schedule's nifty full day view
	widget, but with Gtk's elegance :-)

	* Makefile.am (gnomecal_SOURCES): Added gncal-full-day.[ch] to the sources.

1998-04-02  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* eventedit.c: Object editor widget.  We dropped ObjEdit.

	* timeutil.c (time_from_isodate): Fix.

	* view-utils.c (view_utils_draw_events): Changed the display
	formats. 

1998-04-02  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* view-utils.c (view_utils_draw_events): Use better format
	specifier for strftime().
	(view_utils_draw_textured_frame): Ultra-nifty function to draw
	textured "metal" frames, like Netscape's handles.

1998-04-02  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* gncal-day-view.c (gncal_day_view_update): Day events are now
	cached inside the widget.  They get initialized at this time.

	* view-utils.c (view_utils_draw_events): Use the list of events. 

1998-04-02  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* gncal-day-view.c (gncal_day_view_set_shadow): New customization
	function.  We can't decide on a stupid border type :-)
	(gncal_day_view_init): Made GTK_SHADOW_ETCHED_IN be the default
	shadow type.  Looks good.

1998-04-02  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* main.c: New main program that uses our new datatypes and
	objects. 

	* calendar.c (calendar_load_from_vobject, calendar_load):
	Implement loading of vCalendar objects and vCalendar files. 

	* calobj.c (ical_object_create_from_vobject): Implement loading of
	vCalendar event and todo objects. 

	* timeutil.c (isodate_from_time_t): New function. 

	* gnome-cal.c, gnome-cal.h: Implement a toplevel widget, derived
	from GnomeApp.  It holds all of the day views and arbitrates the
	display.

1998-04-02  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* gncal-week-view.[ch]: New week view composite widget.  This
	provides a full week view (7 day views plus busy time display --
	the latter is currently unimplemented).

1998-04-01  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* gncal-day-view.c: New day view widget.  It is intended to be a
	child widget of the week view composite widget.

	* calendar.c (calendar_get_objects_in_range):
	(calendar_get_events_in_range): 
	(calendar_get_journal_in_range): 
	(calendar_get_journal_in_range): These functions now take a
	sort_func parameter, which is of type GCompareFunc.  If the
	specified value is non-NULL, it will return a sorted list.
	Otherwise, it will return an unordered list.
	(calendar_compare_by_dtstart): Provide a generic sorting routine
	for calendar objects.

1998-04-01 Miguel de Icaza <miguel@kernel.org>

	* Start from scratch
	
Tue Mar 31 23:46:50 1998  Tom Tromey  <tromey@cygnus.com>

	* timeutil.c (format_simple_hour): `buf' now static.

1998-03-31  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* gncal.c: Removed #include "gtkcalendar.h", because it now comes
	from libgnomeui.

	* Makefile.am (gncal_SOURCES): Added new source files to the rules.

	* timeutil.c (format_simple_hour): New function, formats an
	hour/am_pm pair into a string of the form "3am", "12pm", "05h",
	"19h", etc.  It is used by the day view widget for its labels.

1998-03-31 Craig Small <csmall@small.dropbear.id.au>

	* Now has (non working) session maangement
	* Uses a clist for the dailylist like gtt

Sat Mar 21 15:43:20 1998  Tom Tromey  <tromey@cygnus.com>

	* gncal.c: Use gnome_message_box_*, not gnome_messagebox_*.

1998-03-12  Craig Small <csmall@small.dropbear.id.au>

	* Now linked (in some horrible way) to the gtkcalendar widget.

Sun Mar  8 16:38:10 1998  Tom Tromey  <tromey@cygnus.com>

	* Makefile.am (INCLUDES): Added GNOME_INCLUDEDIR.
	(gncal_LDADD): Don't include libsupport.a.

	* gncal.c (main): Use new gnome_init.

1998-02-19  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* gncal.c (main): Added app_id "gncal".

1998-02-19  Carsten Schaar  <nhadcasc@fs-maphy.uni-hannover.de>

	* Makefile.am (gncal_LDADD): Added '$(INTLLIBS)'

1998-02-18  Raja R Harinath  <harinath@cs.umn.edu>

	* Makefile.am (gncal_LDADD): Include `libsupport.a'.

	* calcs.c (month_atoi): Replace buggy explicit loop string compare
	with strcasecmp.
	(day_atoi): Likewise.

Sun Jan 25 23:38:30 1998  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* menus.c: Replace "Quit" with "Exit".
