1998-09-30  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* year-view.c (mark_current_day): New function to mark the current
	day in the year view.

	* mark.c: Removed mark_current_day from here.

1998-09-29  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* prop.c (fetch_color_spec): Changed name from fetch_prelight_spec
	and made it conform to the new prelighting mechanism.
	(fake_mark_days): Set the proper day attributes.
	(reconfigure_month): Use colorify_month_item().
	(fake_mark_days): Use mark_month_item_index().

	* mark.c (colorify_month_item): New public function to reset the
	colors in a month item.
	(get_attributes): New internal function that creates an array of
	attributes for the days in a month item.  This is the basis of all
	the new optimizations to month item marking.
	(unmark_month_item): Now it uses the attributes array to unmark
	only the days that need unmarking.
	(mark_event_in_month): Update the day attributes array.
	(month_item_prepare_prelight): Changed the definition of the
	prelight color query function.  Use the new function.
	(day_event): Do color changes based on the day attributes array.
	(mark_month_item_index): New public function to mark a single day
	by index.
	(mark_event_in_month): Use mark_month_item_index().

	* gnome-month-item.c (gnome_month_item_num2child): Now takes an
	int, not a GnomeMonthItemChild.
	(gnome_month_item_child2num): Now returns an int, not a
	GnomeMonthItemChild.
	(gnome_month_item_num2day): Now takes an int, not a
	GnomeMonthItemChild.

	* goto.c (goto_dialog): Create the days before the year spin
	button, because the year_changed callback expects the month item
	to be created.  The new semantics of the spin button cause it to
	emit a value_changed signal on the adjustment upon creation -- is
	this the behavior we want from it?
	(goto_dialog): Use gtk_window_set_modal() instead of the
	deprectaed gnome_dialog_set_modal().

	* quick-view.c (quick_view_new): Make it look not as crappy by
	putting the title inside the frame.
	(quick_view_do_popup): Fixed the pointer grab and added a cursor.
	(create_items_for_event): Query the text width/height from the
	text item using the new object arguments, so that the size of the
	popup window can be set properly.

	* year-view.c (do_quick_view_popup): Calculate a nice date string
	for the popup window.

1998-09-28  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* quick-view.[ch]: New file that presents a quick view of the
	events in a particular day when the mouse is clicked on the year
	view.  Work in progress.

	* year-view.c (do_quick_view_popup): New function that creates a
	quick view for the events in a day.

	* Makefile.am (gnomecal_SOURCES): Added quick-view.[ch] to the
	list of sources.

1998-09-27  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* main.c: Hotkey for File/Exit should be C-q, not C-x.

1998-09-24  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* year-view.c (do_popup_menu): New function to execute the popup
	menu in the year view.
	(day_event): Invoke the popup menu with the context set to days.
	(new_appointment): New function to create a new appointment from
	the year view.
	(do_jump): New function to do the appropriate view/date jumping
	from the popup menu.

	* main.c: Fixed two icons in the File menu.

1998-09-21  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* main.c: Added underlined shortcuts and accelerators to the main menu.

1998-09-16  Raja R Harinath  <harinath@cs.umn.edu>

	* gncal-week-view.c (<gtk/gtklabel.h>): Include.
	* gncal-week-view.h (<gtk/gtkvbox.h>): Include.

1998-09-06  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* gnome-cal.c (mail_notify): Fixed the bug reported about the mail
	notification not beint sent until the program was terminated.

1998-09-03  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* gncal-full-day.c (gncal_full_day_forall): Updated foreach ->
	forall from Gtk changes, bleah.

	* year-view.c (day_event): New function to handle events from
	days.  Jumps to the day that is clicked.

	* main.c: Use a watch cursor while the previous/today/next
	functions are doing their job.

	* mark.c (month_item_prepare_prelight): New public utility
	function to prepare a month item for prelighting.  It will store
	the proper prelight information and attach the appropriate signals.
	(mark_current_day): Make the current day bold as well (useful for
	color-blind people, I guess).

	* prop.c (set_current_day): Reset the date in the sample calendar
	and mark the current day.
	(fake_mark_days): Mark fake events in the sample calendar.

	* year-view.c (year_view_set): Use the general prelighting engine.

	* goto.c (day_event): Just process button presses, as prelighting
	is done behind the scenes now.
	(update): Use the general prelighting engine.

	* prop.c (create_colors_page): We can now configure the colors of
	the monthly calendars!  Wheeeeee!  There are still some nits to be
	fixed, which are listed in the TODO file.
	(build_color_spec): New function to build color specifications.
	(parse_color_spec): New function to parse color specifications.

	* mark.c: Modified all functions to use the configured colors.
	* goto.c: Likewise.

	* main.c (colors_changed): New function that notifies all
	calendars that colors have changed.

	* gnome-cal.c (gnome_calendar_colors_changed): New function that
	notifies all the views that the colors have changed.

	* month-view.c (month_view_colors_changed): New function that
	notifies the month view that colors have changed.

	* year-view.c (year_view_colors_changed): New function that
	notifies the year view that colors have changed.

	* gnome-month-item.h (struct _GnomeMonthItem): Added fields for
	outline and day box colors.

	* gnome-month-item.c (gnome_month_item_set_arg): Added
	outline_color, outline_color_gdk, day_box_color, and
	day_box_color_gdk arguments to month items.  These are convenient
	to quickly set the colors of the month item.
	(gnome_month_item_get_arg): Likewise.

	* main.[ch]: Added a global array of structures for color preferences.

1998-08-31  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* goto.c: Small code cleanup.
	(day_event): Upon receiving a LeaveNotify event, Reset the day's
	background to the correct color.

1998-08-29  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* mark.[ch]: New files with utility functions to mark calendars
	with their events.

	* mark.c (mark_month_item): New public function to mark a month
	item with events.
	(unmark_month_item): New public function to unmark all the days in
	a month item to their default appearance.

	* year-view.c (year_view_set): Use the new unmark_month_item() and
	mark_month_item() to mark the months with events.

	* goto.c (update): New function that updates the calendar in the
	Go-to dialog by marking the days.

	* timeutil.c (time_year_begin): Modified to take a time_t value.
	(time_year_end): Likewise.
	(time_month_begin): Actually implemented this function, which was
	in the header file but not here.
	(time_days_in_month): New public function that returns the number
	of days in a month.

	* Makefile.am (gnomecal_SOURCES): Added mark.[ch] to the sources.

	* year-view.c (unmark_days): Use unmark_month_item().

	* gncal-full-day.c (gncal_full_day_destroy): Fixed crash when
	destroying the full day view.  The full day's destroy method is
	unusual in that it destroys the list of child widgets itself, as
	it does not have a remove method, so it needs to reset the list to
	NULL.

1998-08-27  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* gnome-month-item.c (build_month): Now does the correct thing
	when the user wants weeks to start on Monday.  Now all the Monday
	special casing, as far as day numbering is concerned, is only in
	this function.

	* year-view.c (mark_days): This function marks the days that have
	events in them.  It also fixes a memory leak in the old
	implementation (it was leaking the whole list).
	(unmark_days): New function used to unmark all the days in the
	year view.
	(mark_event): New function that marks all the days that are
	spanned by a time range.  It also fixes the bug in the old
	implementation where it could possibly mark days past the ends of
	the year (if the event crosses year boundaries, for example).

	* timeutil.c (time_year_begin): Take the year parameter since year
	1, not 1900.
	(time_year_end): Likewise.

	* year-view.c (year_view_size_allocate): Now changing the size of
	the calendars is done in the idle loop.
	(idle_handler): This function actually does the resizing of the items.

	* year-view.h (struct _YearView): Added idle_id and need_resize
	fields.

1998-08-26  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* year-view.c: Beginning of the new year view.  Sizing and event
	marking needs to be finished.

	* gnome-cal.c: Updated for year-view.
	(gnome_calendar_time_format_changed): Use year_view_time_format_changed().

	* year-view.[ch]: Renamed the gncal-year-view.[ch] files to
	year-view.[ch].

	* Makefile.am (gnomecal_SOURCES): Updated year-view.[ch] in the
	list of source files.

1998-08-25  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* goto.c (create_days): Set the heading color of the month item.

	* main.c: Use GNOME_STOCK_PIXMAP_JUMP_TO, now that it exists,
	instead of goto.xpm.  Also, removed goto.xpm from cvs.

	* gnome-month-item.h (struct _GnomeMonthItem): Added fields for
	the heading and day number fonts.  Added fields for heading and
	day number label colors.

	* gnome-month-item.c (gnome_month_item_class_init): ARG_DAY_NAMES
	should be write-only.  Also, added arguments for heading and day
	number fonts.  Added arguments for heading and day number colors.

1998-08-24  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* prop.c (build_two_radio_group): Doh.  Set the state of the radio
	buttons properly.

	* month-view.c (month_view_time_format_changed): New public
	function that notifies the month view of a time format change.

	* gnome-cal.c (gnome_calendar_time_format_changed): New public
	function that notifies the calendar of a time format change.

	* main.c (time_format_changed): Use gnome_calendar_time_format_changed().

	* month-view.c (month_view_update): New public function to update
	the month view when an event changes.  This is still unfinished.
	(month_view_set): New public function to set the month in the
	month view.

	* gnome-cal.c (gnome_calendar_direction): Add case for month view.
	(gnome_calendar_set_view): Likewise.
	(gnome_calendar_update_all): Likewise.

	* timeutil.c (time_add_week): Implemented the time_add_week()
	function, which was on the header file.
	(time_add_month): Added public month-adding routine.

	* gnome-cal.c (gnome_calendar_get_current_view_name): Add case for
	month view.
	(gnome_calendar_goto): Likewise, and set the time on the month view.

	* month-view.c (month_view_new): Now it takes the calendar plus
	the time_t representing the month.

	* gnome-month-item.h: Added documentation on the object arguments
	for the month item.

	* month-view.c (month_view_init): Added a month/year heading to
	the month view.

	* TODO: Updated the TODO list a bit.

	* main.c (gnome_cal_file_menu): The preferences menu option should
	go in the File menu.
	(gnome_cal_edit_menu): Added stock pixmaps to the menu items.
	(gnome_cal_menu): Renamed the Calendar menu to Edit.
	(gnome_cal_help_menu): Use "About Gnomecal", not just "About".

	* prop.c (hour_activated): Notify the property box that it has changed.

	* main.c: Changed the Properties menu item to Preferences.  These
	are global application preferences, not a single calendar's
	properties.

	* prop.c (prop_apply): Save the week_starts_on_monday flag to the
	configuration file.
	(properties): Added a check button for weeks starting on Monday.
	(properties): Beautified the Preferences dialog.

	* month-view.c (month_view_init): 
	* goto.c (create_days): Set the month item to start weeks on
	Monday if appropriate.

	* main.c (init_calendar): A boolean is not an hour, so don't
	range_check_hour() on it.
	(init_calendar): Added a global week_starts_on_monday flag.

	* main.h: Added global week_starts_on_monday flag.

1998-08-21  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* calobj.c (ical_object_create_from_vobject): If mail alarm or
	program alarm are missing the action, then set an empty default. 

1998-08-18  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* gnome-month-item.c (gnome_month_item_day2index): New public
	function to get the displayed day index of the specified date.

	* gnome-cal.c (gnome_calendar_goto_today): New public function to
	jump to the current day.

	* goto.c (day_event): Jump to the selected day when the user
	clicks the mouse, and prelight days as appropriate.

	* timeutil.c (time_from_day): New public function to build a
	time_t from a year/month/day triplet.

	* gnome-month-item.c (gnome_month_item_num2child): 
	(gnome_month_item_child2num): New public functions to convert an
	index into a child and vice-versa, respectively.
	(gnome_month_item_num2day): New public function to convert a child
	number into a displayed day number.

	* goto.c (goto_dialog): Doh, use gnome-dialog properly :-)

	* gnome-month-item.c (create_items): Use g_strdup()ed day names
	from the start.

1998-08-17  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* main.c (gnome_toolbar): Made it use goto.xpm.

	* Makefile.am (EXTRA_DIST): Added goto.xpm to the list of files.

1998-08-13  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* gnome-month-item.c (gnome_month_item_set_arg): Doh.  Actually
	recalculate the days using the month and year.

	* main.c: Added "Go to" button to quickly jump to a specific date.

	* goto.c: New file that defines the quick go-to date dialog.

	* Makefile.am (gnomecal_SOURCES): Added goto.c to the sources.

1998-08-11  Nuno Ferreira  <nmrf@rnl.ist.utl.pt>

	* main.c (new_calendar): Made title i18n friendly. This was bug
	#215.

	* eventedit.c (ee_store_recur_end_to_ical): Set recur->enddate to
	recur->_enddate, not to itself, when adding recurring event and
	supplying an end date. This fixes (at least part of) bug #99.

1998-08-10  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* month-view.[ch]: Start of the month view widget.  This will use
	the generic month item and extend it to have the semantics desired
	for the gnomecal month view.

	* gnome-month-item.[ch]: New generic canvas item for the month
	view and the "small calendars".  This is intended to be a
	high-level display engine for monthly calendars.  This is a work
	in progress.

	* gnome-cal.h (GnomeCalendar): Added a month_view field.

	* gnome-cal.c (setup_widgets): Create the month view and insert it
	into the notebook.

	* Makefile.am: Added month-view.[ch] and gnome-month-item.[ch] to
	the sources.

1998-08-03  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* main.c (about_calendar_cmd): Use an array of const strings to
	keep gcc happy.

	* alarm.c (alarm_compare_by_time): Use gconstpointer to keep gcc happy.
	* calendar.c (calendar_object_compare_by_start): Likewise.
	* gncal-full-day.c (child_compare_by_start): Likewise.

1998-07-07  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* main.c: Add support for --view flag.
	(session_save_state): Save the view mode;
	(new_calendar): Now takes a view mode flag.

	* gnome-cal.c (gnome_calendar_get_current_view_name): New
	function for enhancing the session management support for
	gnomecal. 
	(gnome_calendar_set_view): New function that makes a given page
	active. 

1998-07-01  Nuno Ferreira  <nmrf@rnl.ist.utl.pt>

	* gncal.desktop: Added Portuguese translation.

Mon Jun 22 13:01:16 1998  Havoc Pennington  <hp@pobox.com>

	* main.c (session_save_state): Use gnome_geometry_string to get 
	the geometry string.

1998-06-04  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* eventedit.c (ee_rp_init_rule): Do not subtract 1 from
	tm->tm_mday for the default_day.

	* gnome-cal.c (gnome_calendar_new): 
	(gnome_calendar_goto): Use the start of the day -- things expect
	it to be that way.

1998-05-27  Nuno Ferreira  <nmrf@rnl.ist.utl.pt>

	* eventedit.c (ee_store_recur_rule_to_ical): Fill in
	ical->recur->interval from value in spin_button. This ixed an
	infinnite loop.

1998-05-30  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* gncal-full-day.c (child_draw): Paint the decorations correctly.
	(child_draw_decor): Paint the recurrence/bell icons correctly.

1998-05-25  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* eventedit.c (ee_rp_init_rule): Use the contents of
	ee->ical->dtstart for computing the predefined values of the recurrence.

	* gncal-full-day.c (gncal_full_day_unrealize): Fix the gc
	destruction in the unrealization code and fix the pixmap unrefing.

	* main.c (close_cmd): Remove a bad hack that disabled calendar
	widget destruction.

	* calobj.c (ical_object_generate_events): Fix for the weekly event
	generation.  Was reported on the bug tracking system. 

1998-05-18  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* gncal-full-day.c (layout_children): Implemented ultra-cool
	layout for the events that share the same time range.  Gals and
	guys you can now drop Outlook on the recycle bin.  

	Which reminds me.  We do not have a recycle bin.  How could that
	happen in a project as cool as this one?  Someone explain this to
	me. 

1998-05-18  Federico Mena  <federico@nuclecu.unam.mx>

	* gncal-full-day.c (paint_back): Eliminated unnecessary border repainting.

Sun May 17 17:55:03 1998  Havoc Pennington  <hp@pobox.com>

	* gncal-todo.c (simple_todo_editor): Close dialog when return is pressed.

1998-05-15  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* gnome-cal.c (mark_gtk_calendar_day): Bug free version of the
	range computation in place. 

	* gncal-year-view.c (year_view_mark_day): Use the same new version
	of the range computation here. 

	* calobj.c (ical_object_generate_events): Fix the begin/end
	condition.  

1998-05-14  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* timeutil.c (isodate_from_time_t): Do not add the spurious
	padding. 

	* calobj.c (store_date_list): Bug fix:  I was using the wrong
	pointer when saving the exception date list. 
	(set_date_list): Bug fix:  load correctly the complete exception
	date list. 
	(set_date_list): Use ',' for the exception date separator as the
	versit people can not get their standard right. 

	* gncal-full-day.c (unrecur_appointment): Support for making an
	existing recurrent event `movable' for a day.

	* calobj.c (ical_object_add_exdate): New routine, used to add
	exception dates. 
	(ical_object_duplicate): New routine:  used to do the magic
	recur->no-recur event.

1998-05-08  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* gncal-full-day.c (new_appointment): Use gtk_calendar freeze/thaw

	* gncal-year-view.c (gncal_year_view_set_year): Use gtkcalendar freeze/thaw. 

	* eventedit.c (event_editor_init): Use gnome_dialog_set_close to
	avoid the ugly warning. 

	* main.c (display_objedit): Default to the day the user is looking
	at. 

1998-05-05  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* gncal-day-panel.c (full_day_size_allocated): Do not emit a value
	changed signal if the value is the same. 

1998-05-04  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* prop.c (prop_apply): Only run the apply code once.

1998-05-03  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* gncal-day-panel.c (update): Draw the day at startup. 
	(gncal_day_panel_set): Fix selected-day display. 
	(gncal_day_panel_new): Switch day on double clicks, not on single
	clicks. 

	* calobj.c (ical_object_compute_end): Removed debug messages. 

1998-04-30  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* prop.c (prop_apply): Do not call prop_cancel, ths is now using
	GnomePropertyDialog. 

1998-04-29  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* gncal-week-view.c (sync_week): Use gnome_calendar_tag_calendar.

	* gnome-cal.c (gnome_calendar_tag_calendar): New routine used to
	fill a gtk_calendar with the events on a GnomeCalendar object.

	* gncal-week-view.c (gncal_week_view_new): Set the week to the day
	we double clicked. 

1998-04-28  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* gnome-cal.c (calendar_notify): Apply black magic to get mail
	notifications to work. 

	* gncal-full-day.c (child_focus_out): Temporary optimization, the
	child_focus_out is constantly calling the
	gnome_calendar_object_changed when the property editor has been
	invoked.  This happens every time the mouse moves crosses the main
	window.

	* calendar.c (calendar_object_changed): Reschedule alarms when a
	calendar object has changed its times.

Sat Apr 25 22:20:45 1998  Havoc Pennington  <hp@pobox.com>

	* eventedit.c, eventedit.h: Descend from GnomeDialog. Took vbox
	out of class structure; use GnomeDialog vbox
	instead. gnome_dialog_set_destroy instead of destroying in button
	callbacks. Don't create buttons, separator, or vbox manually. 
	#include <libgnomeui/gnome-dialog.h>.

1998-04-24  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* calobj.c (ical_object_create_from_vobject): Fixed alarm loading;
	Load snooze time and snooze count

1998-04-23  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* calendar.c (calendar_save): Actually save the to-do entries.

	* gncal-todo.c (simple_todo_editor): Now you can add and edit
	to-do entries.

1998-04-22  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* gncal-full-day.c: Made it use popup_menu().

	* popup-menu.c: New file with utility functions for creating popup
	menus.  Maybe such a thing would be useful in libgnomeui, a la
	gnome-app-helper?

	* Makefile.am (gnomecal_SOURCES): Added popup-menu.[ch] to the sources.

1998-04-22  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* prop.c (properties): Added Calendar properties editor.
	(properties): Make the code use a propery box.

	* main.c: Save/load properties (fix to old commit).

1998-04-21  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* gncal-todo.c: New widget for editing TODO lists.  This will be
	worked on a lot.

	* Makefile.am (gnomecal_SOURCES): Added gncal-todo.[ch] to the sources.

	* gncal-day-panel.c: Make it use the new TODO widget.

1998-04-21  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* timeutil.c (isodate_from_time_t): Do not save with the global
	time flag (Z at the end of the isodate).  When we figure out a way
	to load times in GMT time, we will add this back 

	* view-utils.c (popup_menu): Moved this routine here as there are
	more users of this code. 

	* gncal-day-view.c (gncal_day_view_class_init): Add button press
	handler. 
	(new_appointment): New routine for creating appointments on a day.

	

	* main.c (save_ok): Added call to gtk_window_set_wmclass.

	* gncal-day-panel.c (calendar_day_selected): Fix, years for mktime
	should substract 1900 and gtk_calendar stores years relative to
	year 0. 

	* gncal-week-view.c (gncal_week_view_new): Make the week view
	descend from VBox so that we can add a label to it.
	(gncal_week_view_set): Display the ending day of the week
	correctly.

	Added a label that displays the week range. 

1998-04-21  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* gnome-cal.c: Made it use GncalDayPanel.

	* gncal-day-panel.c: New widget for the day view in the main
	calendar toplevel.  It basically takes care of everything
	gnome-cal did by hand with respect to the day view.

	* Makefile.am (gnomecal_SOURCES): Added gncal-day-panel.[ch] to
	the rules.

	* main.c: Added a separator between the About menu item and the
	help topics.

1998-04-20  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* eventedit.c (ee_ok): Mark the event as non-new after accepting changes.
	
1998-04-20  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* gncal-full-day.c (gncal_full_day_get_day_start_yoffset): New
	public function that returns the y offset for the row
	corresponding to the "day begin" time.

	* gncal-full-day.c (gncal_full_day_key_press): Now any printable
	keystroke (not just Return) will activate the selected range.

	* gncal-full-day.c (paint_back): Made it use the new paint_row
	function instead of painting everything directly.  We calculate
	areas in a smarter way so there is even less flicker than before,
	especially when selecting regions.

	* eventedit.c: Sensitize recurrence widgets properly.

	* calobj.c (duration_callback): Pass the correct pointer type to
	is_date_in_list().

1998-04-20  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* calobj.c (duration_callback): Take exception dates into
	account. 

	* gncal-full-day.c (new_appointment): Setup the event editor dates
	to those of the currently displayed day. 
	(gncal_full_day_selection_range): Use sensible values in the case
	no range is selected.
	(new_appointment): Events now use the current day for event creation.

	* view-utils.c: Pretty up the time display.

	* calobj.c (ical_object_compute_end): Initialize
	ico->recur->enddate, otherwise we loop forever during final date computation.

	* eventedit.c: Now recurrence is toggled by a radio button in the
	recurrence page, as the checkbox is confusing. 

	* calobj.c (is_date_in_list): Add support for the exclussion
	dates. 

1998-04-18  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* gncal-year-view.c (double_click): Fix this routine as well.

	* gncal-week-view.c (jump_to_day): Bind the gtkcalendar signals to
	the week. 

	* gncal-year-view.c (gncal_year_view_set_year): Put things in the
	proper range.  Now the year view actually matches this year. 

	* gnome-cal.html: Added small documentation.

	* main.c: Add more icons to the menus;  Rename some menubar
	entries;  Add `new' icon to the toolbar.
	(dump_events): Added argument handling and dumping of events from
	the command line.  Extremely cool.

	* getdate.y: Taken from the CVS source code.  Used for date
	parsing in the command line.

	Internationalized getdate.y.  Wee!  It even works with spanish. 
	
	* calobj.c (ical_object_to_vobject): Add Quoted printable property
	to items containing new lines. 
	(duration): Use unsigned integers, to work around buggy calendar
	files generated by korganizer.

	* main.c (save_calendar_cmd): Do not ask for file name if we are
	saving.
	(save_as_calendar_cmd): New command.
	

1998-04-17  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* alarm.c (alarm_kill, alarm_init, alarm_add): Implement the alarm
	management framework.

1998-04-17  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* calobj.c (ical_new): Added mandatory status property.
	(ical_object_to_vobject): Only store "related" list if it exists.
	(store_list): Add terminating null char and free the correct data.

	* main.c (save_calendar_cmd): Implemented calendar saving.
	(open_calendar_cmd): Implemented calendar loading.
	(new_calendar_cmd): Implemented calendar creation.
	(new_calendar): Don't load our test calendar by default.

	* gncal-full-day.c (delete_appointment): Delete appointment implemented.

	* eventedit.c (ee_store_recur_values_to_ical): Free/create
	ical's recurrence appropriately.
	(ee_rp_init_rule): Initialize all missing parameters from ical.
	(ee_rp_init_ending_date): Initialize missing fields from ical.

1998-04-17  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* gnome-cal.c (gnome_calendar_remove_object): Add support for
	removing objects.

1998-04-17  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* eventedit.c (ee_init_recurrence_page): New function that creates
	the recurrence page in the toplevel notebook.
	(ee_store_recur_values_to_ical): Now we can also store the recurrences.

1998-04-17  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* calobj.c (ical_object_generate_events): Implement
	RECUR_MONTHLY_BY_POS implemented.
	(ical_object_create_from_vobject): Fix the alarm
	initialization code.
	(save_alarm): Save alarms.
	(ical_object_generate_events): Fixed the recurrent code to take
	into account the recur->endate field (if at all specified).

	(ical_object_to_vobject): Implement recurrence rule saving.

1998-04-16  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* eventedit.c (ee_store_alarm): Use menu_shell->children, not
	menu->children.  Why does GtkMenu have a children field in the
	object structure?
	(check_dates): New function that insures that start_date < end_date.
	(check_times): In addition to checking whether the event spans the
	whole day, now it insures that start_time < end_time.

	* gncal-full-day.c (child_set_size): Now children get bigger
	temporarily while they are focused.  This allows the handles not
	to "overlap" the rows used by the child and thus allow editing of
	very thin events.
	(recompute_motion): Fix for new child coordinates.
	(gncal_full_day_expose): Make it use find_child_by_window()
	instead of looking for it by hand.

	* bell.xpm recur.xpm: XPM files for events with alarm and
	recurrence, respectively.

1998-04-15  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* gncal-full-day.c (button_1): Preserve the up/down cursor while dragging.

	* gncal-full-day.c (child_draw): Now children have a vertical
	handle as well.  This can be used to move the child anytime, not
	only when it is focused.
	(recompute_motion): Modified for new drag behavior.

	* eventedit.c (ee_init_general_page): The general_owner may be
	null.  Do the proper thing when creating the label.
	(ee_ok): Update the gnome calendar appropriately.

	* timeutil.h:
	* gncal-year-view.h: Add some missing prototypes.

	* gncal-full-day.c (child_popup_menu): Set the sensitivity of menu
	items according to whether the ical object is being edited or not.

	* eventedit.c (event_editor_new): Set the "being edited" flag on
	the ical object (stored as the ical object's user data).
	(event_editor_destroy): Release the flag.

	* calobj.h: The iCalObject structure now has a generic user_data pointer.
	* calobj.c (ical_object_set_user_data ical_object_get_user_data):
	Functions to set this data.

	* gncal-full-day.c (child_button_press): Do child popup menu correctly.

	* main.c (about_calendar_cmd): Fixed my address and added Arturo
	to the authors in the about box.

	* gncal-full-day.c (find_child_by_window): Compare child's widget
	windows by user_data (which will be the parent widget, that is,
	the text widget).  We cannot assume that child->widget->window
	will be *the* window we are interested on because there may be
	child widgets with multiple windows.

1998-04-15  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* calobj.c (ical_foreach): Define iterator routine.

1998-04-15  Arturo Espinosa Aldama  <arturo@nuclecu.unam.mx>

	* gncal-year-view.[hc]: Now using time_t for new and set.
	  Random fixes, as well.

1998-04-15  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* gncal-full-day.c (button_3): New popup menus activated with
	mouse button 3.
	(create_appointment): Create a new appointment from the popup
	menus.  See the FIXME.

1998-04-15  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* gncal-full-day.c (layout_kill_rows): Routine to destory rows
	array properly.

	* gncal-year-view.c (gncal_year_view_new): Add missing year in
	call to strftime.

	* calobj.c (ical_object_create_from_vobject): Fixed memory leaks
	from the return values of versit's fakeCString.

1998-04-14  Arturo Espinosa Aldama  <arturo@nuclecu.unam.mx>

	* gncal-year-view.[hc]: New widget for the year view.
	* Makefile.am: added required compilation of the new files.

1998-04-14  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* eventedit.c (event_editor_setup_time_frame): Fixed some table
	expansions to make the dialog look nicer when resized.

	* calobj.c (ignore_space): Fixed compiler warning about unused
	computed value.
	(ocurrencelist): Replace str by p confusion.  Removed unused
	variables value and q.
	(daynumber): Fixed a couple of warnings about unused values.
	(load_recurrence): Removed unused variable c.  Added a default
	clause to the switch(type).

	* eventedit.c (ee_rp_init_frequency): Removed unused variable content.
	Fixed a compiler warning by adding a missing cast.

	* calobj.c (ical_object_create_from_vobject): Make the
	load_recurrence() part work correctly.  Eliminated use of
	syntax_error variable.

1998-04-13  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* gncal-full-day.c (child_key_press): Unfocus the child and focus
	the parent fullday widget when the user presses Esc.

	* gncal-week-view.c (gncal_week_view_update): Now takes object and
	flags parameters.
	* gncal-day-view.c (gncal_day_view_update): Likewise.
	* gncal-full-day.c (gncal_full_day_update): Likewise.
	(child_focus_in): New function.  In conjunction with
	child_focus_out(), these only display the handles in the child
	when it is focused.  The result is that the user can see more of
	the child's text when nothing is focused, and we can also display
	fatter and nicer drag handles.

	* gnome-cal.c (gnome_calendar_object_changed): Now takes an
	additional flags parameter 
	(gnome_calendar_update_all): Made function static.  Now takes
	changed object and flags parameters as well.
	(gnome_calendar_object_changed): Now takes additional flags
	parameter to indicate what changed in the specified object.

	* calobj.h (CalObjectChange): New enum with flags to describe what
	has been changed in an object.

	* gncal-full-day.h: 
	* gncal-full-day.c (gncal_full_day_focus_child): New function to
	let the outside world decide which child to focus.
	(gncal_full_day_focus_child): Bleah.  We have to synthesize a
	click because GtkText will not set the cursor when you focus it.

	* gnome-cal.c (day_view_range_activated): Focus the new child in
	the full day widget.

	* eventedit.c (event_editor_setup_time_frame): Re-aligned some
	widgets to make it look prettier.
	(ee_alarm_widgets): Likewise.
	(ee_init_general_page): Likewise.
	(ee_classification_widgets): Likewise.
	(event_editor_init_widgets): Likewise.

	* gnome-cal.c (day_view_range_activated): Create new object and
	add it to the calendar.  You can now select a range in the
	full-day view, hit Return, and a new event will be added at the
	selected range.  I still have to figure out how to focus this new child.

	* gncal-full-day.c (paint_back): Rewrote function to avoid
	painting an area more than once -- eliminate flicker.
	(paint_back_rows): New function that calls paint_back() only for
	the area of the specified rows.
	(gncal_full_day_button_press): 
	(gncal_full_day_button_release): 
	(gncal_full_day_motion): Made these functions use
	paint_back_rows() instead of paint_back(), to eliminate flicker.  Wheee!

1998-04-12  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* gnome-cal.c (setup_day_view): We now connect to the
	range_activated signal of the fullday widget instead of catching
	key presses ourselves.
	(day_view_range_activated): New function that creates a new
	iCalObject and inserts it into the calendar, not finished yet.

1998-04-11  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* gncal-full-day.c (get_time_from_rows): New function, calculates
	a pair of time_t values from the specified start and number of rows.

	* gncal-full-day.h (GncalFullDayClass): New signal
	"range_activated".  It is emitted when a range is selected and the
	user hits Return.
	(gncal_full_day_selection_range): New function, returns the
	selected range.

	* gncal-full-day.c (struct drag_info): Moved selection information
	to their own fields instead of sharing the child's drag fields.
	This allows us to keep the selection when a child is moved.
	(recompute_motion): Made the case when (row < di->sel_click_row)
	work correctly.

1998-04-11  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* gnome-cal.c (gnome_calendar_goto): Add support for navigating
	on the day view.

	* timeutil.c (time_start_of_day, time_end_of_day, time_day_hour):
	New time manipulation functions. 

	* eventedit.c (ee_rp_init_frequency): Add the different frequency
	editors to a notebook.  Make the notebook startup on the entry
	selected recurrence type;

1998-04-11  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* gncal-full-day.c (recompute_motion): Now we support selecting a
	range in the main window (by clicking+dragging).  It flickers
	horribly and is not perfect, but it is a start.

1998-04-09  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* gncal-full-day.c: #include <string.h>

	* gncal-full-day.c (child_map): Show instead of just map the child
	widget (otherwise the text widget gets confused and will not focus).

	* calobj.c (ical_object_to_vobject): Quote chars as 'x', not "x".

	* calobj.h: Added prototype for ical_object_to_vobject().

	* gnome-cal.c (gnome_calendar_object_changed): New function.  This
	should be called when a calendar object is changed.

	* gncal-full-day.c (update_from_drag_info): Call
	gnome_calendar_object_changed() instead of updating manually.

	* calendar.c (calendar_add_object):
	(calendar_remove_object): Set the modified flag to true.

	* gncal-full-day.c (gncal_full_day_draw): Finished implementing
	this function.

1998-04-08  Raja R Harinath  <harinath@cs.umn.edu>

	* gncal.c (update_calendar): Say `#if 0', not `#ifdef 0'.

1998-04-07  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* eventedit.c: Removed unused global variable parent_class.

	* eventedit.h: Renamed gtk_window field to window.
	Made the parent_class field in the EventEditorClass structure be a
	GtkWindowClass, not a gnome property box class.
	Added prototype for event_editor_get_type().

1998-04-06  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* gncal-week-view.c (gncal_week_view_new): Use the new
	gtk_table_set_homogeneous() instead of setting the variable directly.

1998-04-03  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* eventedit.c (ee_create_ae): Make it return void.
	(ee_alarm_widgets): Remove some unused variables.
	(ee_store_alarm): Make it return void.
	#include <string.h>

	* eventedit.h: #include "gnome-cal.h"

	* calobj.c (list_free): Don't use g_free in the g_list_foreach.

	* calendar.h: Add prototype for calendar_load().

	* timeutil.h: Add prototypes for time_add_*().

	* calendar.c:
	* calobj.c:
	* eventedit.c:
	* gnome-cal.c: #include "timeutil.h"

	* gncal-day-view.c (gncal_day_view_size_request): Make the minimum
	width equal or larger to the title width.

	* main.c: #include "eventedit.h"
	(main): Add a return statement.
	(new_calendar): Show stuff *after* the calendar has been loaded.

	* gnome-cal.c (gnome_calendar_load): Update the day view.
	(setup_widgets): Hackish setup of a day view widget - will fix later.
	(gnome_calendar_init): Initialize all fields.

	* gnome-cal.h: Added day_view field.  Maybe this should be changed
	when the a complete day view panel is complete.

	* gncal-day-view.c (gncal_day_view_update): Draw after update, not
	before.

1998-04-06  Carsten Schaar  <nhadcasc@fs-maphy.uni-hannover.de>

	* versit/.cvsignore: New file.

Fri Apr  3 22:31:54 1998  Tom Tromey  <tromey@cygnus.com>

	* calendar.c: Include <config.h>.

1998-04-03  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* timeutil.c (time_add_year, time_add_year, time_add_week):
	Routines for time manipulation.

	* calobj.c (ical_object_destroy): Full destruction of the object.

	* eventedit.c: Finished the main event editor form;  It still
	lacks the details and the recurrence bits.  It now adds events
	and cancels. 

1998-04-03  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* view-utils.c (view_utils_draw_events): The "better" format
	string for strftime() wasn't better, after all :-(

1998-04-02  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* gncal-full-day.c: New full-day widget.  It is still a work in
	progress.  It will be similar to M$ Schedule's nifty full day view
	widget, but with Gtk's elegance :-)

	* Makefile.am (gnomecal_SOURCES): Added gncal-full-day.[ch] to the sources.

1998-04-02  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* eventedit.c: Object editor widget.  We dropped ObjEdit.

	* timeutil.c (time_from_isodate): Fix.

	* view-utils.c (view_utils_draw_events): Changed the display
	formats. 

1998-04-02  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* view-utils.c (view_utils_draw_events): Use better format
	specifier for strftime().
	(view_utils_draw_textured_frame): Ultra-nifty function to draw
	textured "metal" frames, like Netscape's handles.

1998-04-02  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* gncal-day-view.c (gncal_day_view_update): Day events are now
	cached inside the widget.  They get initialized at this time.

	* view-utils.c (view_utils_draw_events): Use the list of events. 

1998-04-02  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* gncal-day-view.c (gncal_day_view_set_shadow): New customization
	function.  We can't decide on a stupid border type :-)
	(gncal_day_view_init): Made GTK_SHADOW_ETCHED_IN be the default
	shadow type.  Looks good.

1998-04-02  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* main.c: New main program that uses our new datatypes and
	objects. 

	* calendar.c (calendar_load_from_vobject, calendar_load):
	Implement loading of vCalendar objects and vCalendar files. 

	* calobj.c (ical_object_create_from_vobject): Implement loading of
	vCalendar event and todo objects. 

	* timeutil.c (isodate_from_time_t): New function. 

	* gnome-cal.c, gnome-cal.h: Implement a toplevel widget, derived
	from GnomeApp.  It holds all of the day views and arbitrates the
	display.

1998-04-02  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* gncal-week-view.[ch]: New week view composite widget.  This
	provides a full week view (7 day views plus busy time display --
	the latter is currently unimplemented).

1998-04-01  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* gncal-day-view.c: New day view widget.  It is intended to be a
	child widget of the week view composite widget.

	* calendar.c (calendar_get_objects_in_range):
	(calendar_get_events_in_range): 
	(calendar_get_journal_in_range): 
	(calendar_get_journal_in_range): These functions now take a
	sort_func parameter, which is of type GCompareFunc.  If the
	specified value is non-NULL, it will return a sorted list.
	Otherwise, it will return an unordered list.
	(calendar_compare_by_dtstart): Provide a generic sorting routine
	for calendar objects.

1998-04-01 Miguel de Icaza <miguel@kernel.org>

	* Start from scratch
	
Tue Mar 31 23:46:50 1998  Tom Tromey  <tromey@cygnus.com>

	* timeutil.c (format_simple_hour): `buf' now static.

1998-03-31  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* gncal.c: Removed #include "gtkcalendar.h", because it now comes
	from libgnomeui.

	* Makefile.am (gncal_SOURCES): Added new source files to the rules.

	* timeutil.c (format_simple_hour): New function, formats an
	hour/am_pm pair into a string of the form "3am", "12pm", "05h",
	"19h", etc.  It is used by the day view widget for its labels.

1998-03-31 Craig Small <csmall@small.dropbear.id.au>

	* Now has (non working) session maangement
	* Uses a clist for the dailylist like gtt

Sat Mar 21 15:43:20 1998  Tom Tromey  <tromey@cygnus.com>

	* gncal.c: Use gnome_message_box_*, not gnome_messagebox_*.

1998-03-12  Craig Small <csmall@small.dropbear.id.au>

	* Now linked (in some horrible way) to the gtkcalendar widget.

Sun Mar  8 16:38:10 1998  Tom Tromey  <tromey@cygnus.com>

	* Makefile.am (INCLUDES): Added GNOME_INCLUDEDIR.
	(gncal_LDADD): Don't include libsupport.a.

	* gncal.c (main): Use new gnome_init.

1998-02-19  Federico Mena Quintero  <federico@nuclecu.unam.mx>

	* gncal.c (main): Added app_id "gncal".

1998-02-19  Carsten Schaar  <nhadcasc@fs-maphy.uni-hannover.de>

	* Makefile.am (gncal_LDADD): Added '$(INTLLIBS)'

1998-02-18  Raja R Harinath  <harinath@cs.umn.edu>

	* Makefile.am (gncal_LDADD): Include `libsupport.a'.

	* calcs.c (month_atoi): Replace buggy explicit loop string compare
	with strcasecmp.
	(day_atoi): Likewise.

Sun Jan 25 23:38:30 1998  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* menus.c: Replace "Quit" with "Exit".
